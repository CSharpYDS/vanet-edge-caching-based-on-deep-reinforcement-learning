# 这周主要整理了下数学模型和公式，并学习DQN优化的常见策略

## 符号表

| 符号              | 含义                                                         |
| ----------------- | ------------------------------------------------------------ |
| $t$               | 系统内划分的的时隙 $t\in\{1,2,...,\Tau\}$                    |
| $T$               | 每个时隙的长度                                               |
| $\Tau$            | 一个观察周期内的时隙总数                                     |
| $R$               | MEC 覆盖范围下的 RSU 总数                                    |
| $V_i$             | RSU $i$ 下的联网车辆总数                                     |
| $r_r$             | RSU 的覆盖范围半径                                           |
| $r_i$             | 联网车辆的通信范围半径                                       |
| $F$               | 系统内可供请求的内容总数                                     |
| $\lambda_{arr}$   | 时隙内车辆到达 RSU 覆盖范围的期望数量                        |
| $S_f$             | 序号为 $f\in{1,2,...,F}$ 的内容所占容量大小                  |
| $\sigma$          | 内容流行度 Zipf 分布的偏度因子                               |
| $rank_f$          | 内容 $f$ 在 RSU 覆盖范围下的流行度排名                       |
| $P_{i,f}(t)$      | 内容 $f$ 在 $t$ 时隙中的内容流行度                           |
| $\phi$            | 霍克斯过程中历史事件对未来事件的影响因子                     |
| $\delta$          | 霍克斯过程中基于时间的历史事件影响程度的衰减系数             |
| $t^{req}_{i,f}$   | 文件 $f$ 在 RSU $i$ 范围下被请求这一事件的发生时间           |
| $B_{v2r}$         | RSU 向车辆传输内容的带宽                                     |
| $B_{r2r}$         | RSU 间传输内容的带宽                                         |
| $B_{v2b}$         | 基站向车辆传输内容的带宽                                     |
| $S_{cache}$       | RSU 的缓存空间大小                                           |
| $Z$               | 系统缓存矩阵，由 $R * F$ 的空间构成                          |
| $z_{i,f}$         | 判断内容 $f$ 是否缓存在 RSU $i$ 中的状态的变量（$Z$ 矩阵中的一个元素） |
| $\lambda_{req}$   | 表示联网车辆的内容请求率（时隙内的期望请求数量）             |
| $T_{i,j}$         | RSU $i$ 下的车辆 $j$ 所剩余的传输时间                        |
| $v_{i,j}$         | RSU $i$ 下的车辆 $j$ 的移动速度                              |
| $a^{req}_{i,j,f}$ | 表示车辆 $j$ 向 RSU $i$ 请求内容 $f$ 的状态变量              |

## 交通模型

1. 车辆速度遵循均值为 $\mu_{v}$ ，标准差为 $\sigma_v$ ，范围为 $[\mu_{v}-3\sigma_v, \mu_{v}+3\sigma_v]$ 的截断正态分布，车辆速度 $v$ 的概率密度函数为：
   $f(v;\mu_v,\sigma_v,a,b) = \frac {\frac{1}{\sigma}\phi(\frac{v-\mu}{\sigma})}{0.997}$
   其中 $\phi$ 表示均值为0,方差为1的标准正态分布
2. 将车辆速度划分为6个区间分别对应6个离散速度等级 $l_n$ ，可以通过对概率密度函数积分可得速度落于各区间的概率分别为：（2.357%，13.54%，34.103%，34.103%，13.54%，2.357%）
3. 车辆到达遵循参数为 $\lambda_{arr}$ 的泊松分布，该参数表示时隙内车辆到达 RSU 覆盖范围的期望数量 ($veh/T$)，则时隙内到达 RSU 覆盖范围下的车辆数的概率质量函数为：
   $P(C_{arr})=\frac{\lambda_{arr}^{C_{arr}}}{C_{arr}!}e^{-\lambda_{arr}}$

## 内容流行度模型

1. 系统内有$ F$ 个内容可供请求
2. 内容的大小遵循均值为 $\mu_{size}$，标准差为 $\sigma_{size}$ 的正态分布
3. 内容的初始流行度遵循 Zipf 分布，对于内容 $f\in\{1,2,...,F\}$，其被请求的概率质量函数为：
   $P_f = \frac {\left[ {\sum^F_{f=1} \frac {1}{rank^\sigma_f}} \right]^{-1}}{rank^\sigma_f} (t=0)$
4. 假设内容的原始请求概率已知，随着请求逐渐到来，内容的流行度将会发生变化。为了捕捉内容流行度的变化从而更好地服务于车辆，RSU 中缓存的内容需要在两个时隙数 $t->t+1$ 的交界处进行替换。因此，对于不同的 RSU 都需要更新下一个时隙的请求概率（内容流行度）
5. 使用霍克斯过程对内容流行度的变化进行预测，在一个观察周期 $\Tau$ 内对于 RSU $i$ 和内容 $f$：
   ${P_{i,f}}(t + 1) = {P_{i,f}}(t) + \sum\limits_{{t^{req}_{i,f}} \leq \Tau} \phi {e^{ - \delta \left( {\Tau - {t^{req}_{i,f}}} \right)}}$

## 缓存模型

1. 每个 RSU 拥有相同的缓存容量大小 $S_{cache}$
2. 缓存状态变量 $z_{s,f} = \begin{cases}{1, {\text{内容 f 缓存在 RSU i 中}}}\\{0, {\text{其他情况}}}\end{cases} $
3. 对于 RSU $i$，其缓存内容占用空间需要满足约束：
   $\sum_{f=1}^{F}S_fz_{i,f} \leq S_{cache}$
4. 对于每个内容请求，如果在与之直接相连的 RSU 中已经缓存，则该 RSU 直接向其发送内容，否则将检测 MEC 范围下的其他 RSU 是否含有请求内容，若有的话则先在 RSU 间传输内容后，再由直连 RSU 将内容传输给车辆
   ![](流程图)

### 缓存命中率

## 通信模型

1. 假设每个 RSU 拥有相同的覆盖半径 $r_r$，每辆联网车辆拥有相同的通信范围半径 $r_v$

2. 假设数据传输期间的速率保持不变，且值为 $B_{v2r}$（TODO：改成ZONE模型）

3. 联网车辆的内容请求发送过程服从参数为 $\lambda_{req}$ 的泊松分布，则车辆在一个时隙内的请求发送数的概率质量函数为：
   $P(C_{req})=\frac{\lambda_{req}^{C_{req}}}{C_{req}!}e^{-\lambda_{req}}$

4. 从车辆发出请求到离开 RSU 覆盖范围的时间内可供车辆进行 V2R 通信接收内容，且不一定刚进入 RSU 就发送内容请求，剩余可用的通信时间用 $T_{i,j}$ 表示（$T_{i,j}\in[0,\frac {r_r}{v_{i,j}}]$）

5. 车辆 $j$ 向 RSU $i$ 请求内容 $f$ 可能存在三种结果：

   1. 与之直连的 RSU 含有内容 $f$，即 $z_{i,f} = 1$
   2. 与之直连的 RSU 没有内容 $f$，但 MEC 范围下的其他 RSU 中含有内容 $f$，即 $z_{i,f}=0\ and\ z_{ii,f}=1,\exists ii\in\{1,...,R|ii\ne i\}$
   3. 整个系统内没有 RSU 缓存了内容 $f$，即$z_{i,f}=0,\forall i\in\{1,...,R\}$

   用变量 $a^{req}_{i,j,f}$ 表示：

   $a^{req}_{i,j,f} = \begin{cases}0, \text{场景 1}\\1, \text{场景 2}\\2, \text{场景 3}\end{cases}$

### 吞吐量

1. 当 $a^{req}_{i,j,f} = 0$ 时，直接与 RSU 进行 V2R 内容传输，根据剩余时间内是否可以将内容通过 V2R 通信传递完成，吞吐量 $M$ 可以表示为：
   $M = \min(T_{i,j}*B_{v2r},S_f)$
2. 当 $a^{req}_{i,j,f} = 1$ 时，首先找到 MEC 覆盖范围下的拥有此内容的 RSU，然后该 RSU 将内容协作式传递给与车辆直接相连的 RSU，并根据剩余时间内是否可以将内容通过这一组 R2R-V2R 通信传递完成，吞吐量 $M$ 可以表示为：
   $M = \min \left( {\max \left( {\left( {{T_{i,j}} - \frac{S_f}{{B_{r2r}}}} \right)*B_{v2r},0} \right),S_f} \right)$
3. 当 $a^{req}_{i,j,f} = 1$ 时，车辆直接向基站发送请求，缓存系统内的吞吐量 $M=0$

综上，每个时隙内的吞吐量$M_t$可以表示为：

$M_t = \sum_{i=1}^{R}\sum_{req=1}^{\lambda_{req}}$

### 通信时延

### 能量开销

## 基于 D3DQN（Dueling Double DQN）的缓存替换策略

使用改进 DQN 算法解决高维度离散动作空间下的NP-Hard问题

### 动作空间 Action Space

### 状态空间 State Space

### 回报函数 Reward Function
